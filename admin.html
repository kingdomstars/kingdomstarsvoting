<!DOCTYPE html>
<html>
<head>
  <title>Kingdom Stars Admin</title>
</head>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
  firebase.auth().onAuthStateChanged(user => {
    if (!user) {
      window.location.href = "login.html";
    }
  });
</script>

  <body>
  <h1>Admin â€“ Vote Results</h1>
  <div id="results"></div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="script.js"></script>

  <script>
    db.collection("contestants").onSnapshot(snapshot => {
      document.getElementById("results").innerHTML = "";
      snapshot.forEach(doc => {
        db.collection("votes")
          .where("contestantId", "==", doc.id)
          .get()
          .then(votes => {
            document.getElementById("results").innerHTML +=
              `<p>${doc.data().name}: ${votes.size} votes</p>`;
          });
      });
    });
  </script>
</body>
</html>
<h2>ðŸ“± Mobile Money Votes (Confirm)</h2>
<div id="mobileVotes"></div>

<script>
db.collection("mobileVotes")
  .where("status", "==", "pending")
  .onSnapshot(snapshot => {
    mobileVotes.innerHTML = "";
    snapshot.forEach(doc => {
      const d = doc.data();
      mobileVotes.innerHTML += `
        <p>
          ${d.name} â€“ ${d.phone} â€“ ${d.transactionId}
          <button onclick="approve('${doc.id}', '${d.contestantId}')">Approve</button>
        </p>
      `;
    });
  });

function approve(id, contestantId) {
  db.collection("votes").add({
    contestantId,
    paid: true,
    time: new Date()
  });

  db.collection("mobileVotes").doc(id).update({
    status: "approved"
  });
}
</script>
